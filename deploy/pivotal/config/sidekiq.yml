<%
if ENV.key?('VCAP_SERVICES')
  services = JSON.parse(ENV['VCAP_SERVICES'])
  redis_config = services['rediscloud'].detect { |service| service['name'] =~ /-sidekiq/ }
end
fail 'No Redis service found in environment.' if redis_config.nil?

redis_url = "redis://:#{redis_config['credentials']['password']}@#{redis_config['credentials']['hostname']}:#{redis_config['credentials']['port']}/0"
%>
production:
  server_url: "<%= redis_url %>"
  server_namespace: sidekiq
  server_url: "<%= redis_url %>"
  client_namespace: sidekiq
